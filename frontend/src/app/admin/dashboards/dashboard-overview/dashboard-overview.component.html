<div class="dashboard-overview">
  <!-- Loading Overlay (only for initial load) -->
  <div *ngIf="loading && !fullDashboard" class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-message">
    <mat-icon>error_outline</mat-icon>
    <p>{{ error }}</p>
  </div>

  <!-- Dashboard Content -->
  <ng-container *ngIf="fullDashboard">
    <!-- Dashboard Summary -->
    <div class="dashboard-header">
      <div class="header-content">
        <mat-icon class="dashboard-icon" *ngIf="fullDashboard.dashboard.icon">
          {{ fullDashboard.dashboard.icon }}
        </mat-icon>
        <div class="header-text">
          <h1>{{ fullDashboard.dashboard.title }}</h1>
          <p class="description">{{ fullDashboard.dashboard.description }}</p>
        </div>
      </div>
      <div class="dashboard-actions">
        <button
          mat-icon-button
          (click)="editDashboard()"
          matTooltip="Edit Dashboard"
          class="edit-dashboard-btn"
        >
          <mat-icon>edit</mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="viewDashboard()"
          matTooltip="View Dashboard"
          class="view-dashboard-btn"
        >
          <mat-icon>visibility</mat-icon>
        </button>
      </div>
    </div>

    <!-- Favorites Section -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-icon class="section-icon">star</mat-icon>
        <h2 class="section-title">Favorites</h2>
        <button
          mat-icon-button
          (click)="openAddFavoriteDialog()"
          matTooltip="Add Link to Favorites"
        >
          <mat-icon>add</mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="favoritesReorderMode = !favoritesReorderMode"
          [matTooltip]="favoritesReorderMode ? 'Exit reorder mode' : 'Reorder favorites'"
          [class.active]="favoritesReorderMode"
          class="reorder-toggle"
        >
          <mat-icon>{{ favoritesReorderMode ? 'apps' : 'view_agenda' }}</mat-icon>
        </button>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content>
        <div *ngIf="fullDashboard.favorites.length === 0" class="empty-state">
          <mat-icon>bookmark_border</mat-icon>
          <p>No favorites yet</p>
        </div>
        <div
          *ngIf="fullDashboard.favorites.length > 0"
          cdkDropList
          [class.favorites-grid]="!favoritesReorderMode"
          [class.favorites-list]="favoritesReorderMode"
          (cdkDropListDropped)="onFavoritesDropped($event)"
        >
          <div *ngFor="let link of fullDashboard.favorites" class="link-item" cdkDrag>
            <div class="link-content">
              <mat-icon *ngIf="link.icon" class="link-icon">{{ link.icon }}</mat-icon>
              <div class="link-details">
                <h3>{{ link.title }}</h3>
                <p class="url">{{ link.url }}</p>
                <p class="description" *ngIf="link.description">{{ link.description }}</p>
              </div>
            </div>
            <div class="link-actions">
              <button
                mat-icon-button
                matTooltip="Edit"
                (click)="editFavorite(link)"
                color="primary"
                class="edit-btn"
              >
                <mat-icon>edit</mat-icon>
              </button>
              <button
                mat-icon-button
                matTooltip="Remove"
                (click)="removeFavorite(link)"
                color="warn"
                class="remove-btn"
              >
                <mat-icon>delete</mat-icon>
              </button>
              <button
                *ngIf="favoritesReorderMode"
                cdkDragHandle
                mat-icon-button
                matTooltip="Drag to reorder"
                class="drag-handle"
                type="button"
              >
                <mat-icon>drag_handle</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Categories Section -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-icon class="section-icon">folder</mat-icon>
        <h2 class="section-title">Categories</h2>
        <button mat-icon-button (click)="openAddCategoryDialog()" matTooltip="Add Category">
          <mat-icon>add</mat-icon>
        </button>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content>
        <div *ngIf="fullDashboard.categories.length === 0" class="empty-state">
          <mat-icon>folder_open</mat-icon>
          <p>No categories yet</p>
        </div>

        <div class="categories-grid">
          <div *ngFor="let category of fullDashboard.categories" class="category-section">
            <div class="category-header">
              <div class="category-info">
                <mat-icon class="category-color" [style.color]="category.color || '#999'">
                  folder
                </mat-icon>
                <h3>{{ category.title }}</h3>
                <span class="link-count">({{ category.links.length }})</span>
              </div>
              <div class="category-actions">
                <button
                  mat-icon-button
                  (click)="openAddLinkToCategoryDialog(category)"
                  matTooltip="Add Link"
                  color="primary"
                >
                  <mat-icon>add_link</mat-icon>
                </button>
                <button
                  mat-icon-button
                  (click)="editCategory(category)"
                  matTooltip="Edit Category"
                  color="primary"
                >
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  (click)="removeCategory(category)"
                  matTooltip="Delete Category"
                  color="warn"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>

            <div
              class="category-links"
              cdkDropList
              [cdkDropListData]="category.links"
              (cdkDropListDropped)="onCategoryLinksDropped($event, category)"
            >
              <div *ngIf="category.links.length === 0" class="empty-category">
                <p>No links in this category</p>
              </div>
              <div *ngFor="let link of category.links" class="link-item" cdkDrag>
                <div class="link-content">
                  <mat-icon *ngIf="link.icon" class="link-icon">{{ link.icon }}</mat-icon>
                  <div class="link-details">
                    <h4>{{ link.title }}</h4>
                    <p class="url">{{ link.url }}</p>
                    <p class="description" *ngIf="link.description">{{ link.description }}</p>
                  </div>
                </div>
                <div class="link-actions">
                  <button
                    mat-icon-button
                    matTooltip="Edit"
                    (click)="editLinkInCategory(link)"
                    color="primary"
                    class="edit-btn"
                  >
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    matTooltip="Remove"
                    (click)="removeLinkFromCategory(category.id, link.id, link.title)"
                    color="warn"
                    class="remove-btn"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                  <button
                    cdkDragHandle
                    mat-icon-button
                    matTooltip="Drag to reorder"
                    class="drag-handle"
                    type="button"
                  >
                    <mat-icon>drag_handle</mat-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </ng-container>
</div>
