<div class="dashboard-overview">
  <!-- Loading Overlay (only for initial load) -->
  <output
    *ngIf="loading && !fullDashboard"
    class="loading-spinner"
    aria-live="polite"
    aria-label="Loading dashboard"
  >
    <mat-spinner diameter="50"></mat-spinner>
  </output>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-message" role="alert">
    <mat-icon aria-hidden="true">error_outline</mat-icon>
    <p>{{ error }}</p>
  </div>

  <!-- Dashboard Content -->
  <main role="main" *ngIf="fullDashboard">
    <!-- Dashboard Summary -->
    <div class="dashboard-header">
      <div class="header-content">
        <mat-icon class="dashboard-icon" *ngIf="fullDashboard.dashboard.icon">
          {{ fullDashboard.dashboard.icon }}
        </mat-icon>
        <div class="header-text">
          <h1>{{ fullDashboard.dashboard.title }}</h1>
          <p class="description">{{ fullDashboard.dashboard.description }}</p>
        </div>
      </div>
      <div class="dashboard-actions">
        <button
          mat-icon-button
          (click)="editDashboard()"
          matTooltip="Edit Dashboard"
          aria-label="Edit dashboard"
          class="edit-dashboard-btn"
        >
          <mat-icon aria-hidden="true">edit</mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="viewDashboard()"
          matTooltip="View Dashboard"
          aria-label="View dashboard"
          class="view-dashboard-btn"
        >
          <mat-icon aria-hidden="true">visibility</mat-icon>
        </button>
      </div>
    </div>

    <!-- Favorites Section -->
    <mat-card class="section-card" role="region" aria-labelledby="favorites-heading">
      <mat-card-header>
        <mat-icon class="section-icon" aria-hidden="true">star</mat-icon>
        <h2 class="section-title" id="favorites-heading">Favorites</h2>
        <button
          mat-icon-button
          (click)="openAddFavoriteDialog()"
          matTooltip="Add Link to Favorites"
          aria-label="Add link to favorites"
        >
          <mat-icon aria-hidden="true">add_link</mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="favoritesReorderMode = !favoritesReorderMode"
          [matTooltip]="favoritesReorderMode ? 'Exit reorder mode' : 'Reorder favorites'"
          [attr.aria-label]="
            favoritesReorderMode ? 'Exit favorites reorder mode' : 'Reorder favorites'
          "
          [class.active]="favoritesReorderMode"
          class="reorder-toggle"
        >
          <mat-icon aria-hidden="true">{{
            favoritesReorderMode ? 'apps' : 'view_agenda'
          }}</mat-icon>
        </button>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content>
        <output *ngIf="fullDashboard.favorites.length === 0" class="empty-state" aria-live="polite">
          <mat-icon aria-hidden="true">bookmark_border</mat-icon>
          <p>No favorites yet</p>
        </output>
        <div
          *ngIf="fullDashboard.favorites.length > 0"
          cdkDropList
          [class.favorites-grid]="!favoritesReorderMode"
          [class.favorites-list]="favoritesReorderMode"
          (cdkDropListDropped)="onFavoritesDropped($event)"
        >
          <div *ngFor="let link of fullDashboard.favorites" class="link-item" cdkDrag>
            <div class="link-content">
              <mat-icon *ngIf="link.icon" class="link-icon">{{ link.icon }}</mat-icon>
              <div class="link-details">
                <h3>{{ link.title }}</h3>
                <p class="url">{{ link.url }}</p>
                <p class="description" *ngIf="link.description">{{ link.description }}</p>
              </div>
            </div>
            <div class="link-actions">
              <button
                mat-icon-button
                matTooltip="Edit"
                (click)="editFavorite(link)"
                [attr.aria-label]="'Edit favorite link: ' + link.title"
                color="primary"
                class="edit-btn"
              >
                <mat-icon aria-hidden="true">edit</mat-icon>
              </button>
              <button
                mat-icon-button
                matTooltip="Remove"
                (click)="removeFavorite(link)"
                [attr.aria-label]="'Remove favorite link: ' + link.title"
                color="warn"
                class="remove-btn"
              >
                <mat-icon aria-hidden="true">link_off</mat-icon>
              </button>
              <button
                *ngIf="favoritesReorderMode"
                cdkDragHandle
                mat-icon-button
                matTooltip="Drag to reorder"
                [attr.aria-label]="'Drag to reorder favorite: ' + link.title"
                class="drag-handle"
                type="button"
              >
                <mat-icon aria-hidden="true">drag_handle</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Categories Section -->
    <mat-card class="section-card" role="region" aria-labelledby="categories-heading">
      <mat-card-header>
        <mat-icon class="section-icon" aria-hidden="true">folder</mat-icon>
        <h2 class="section-title" id="categories-heading">Categories</h2>
        <button
          mat-icon-button
          (click)="openAddCategoryDialog()"
          matTooltip="Add Category"
          aria-label="Add category"
        >
          <mat-icon aria-hidden="true">create_new_folder</mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="categoriesReorderMode = !categoriesReorderMode"
          [matTooltip]="categoriesReorderMode ? 'Exit reorder mode' : 'Reorder categories'"
          [attr.aria-label]="
            categoriesReorderMode ? 'Exit categories reorder mode' : 'Reorder categories'
          "
          [class.active]="categoriesReorderMode"
          class="reorder-toggle"
        >
          <mat-icon aria-hidden="true">{{
            categoriesReorderMode ? 'grid_view' : 'view_agenda'
          }}</mat-icon>
        </button>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content>
        <output
          *ngIf="fullDashboard.categories.length === 0"
          class="empty-state"
          aria-live="polite"
        >
          <mat-icon aria-hidden="true">folder_open</mat-icon>
          <p>No categories yet</p>
        </output>

        <div
          [class.categories-grid]="!categoriesReorderMode"
          [class.categories-list]="categoriesReorderMode"
          cdkDropList
          (cdkDropListDropped)="onCategoriesDropped($event)"
        >
          <div *ngFor="let category of fullDashboard.categories" class="category-section" cdkDrag>
            <div class="category-header">
              <div class="category-info">
                <mat-icon class="category-color" [style.color]="category.color || '#999'">
                  folder
                </mat-icon>
                <h3>{{ category.title }}</h3>
                <span class="link-count">({{ category.links.length }})</span>
              </div>
              <div class="category-actions">
                <button
                  *ngIf="!categoriesReorderMode"
                  mat-icon-button
                  (click)="openAddLinkToCategoryDialog(category)"
                  matTooltip="Add Link"
                  [attr.aria-label]="'Add link to category: ' + category.title"
                  color="primary"
                >
                  <mat-icon aria-hidden="true">add_link</mat-icon>
                </button>
                <button
                  *ngIf="!categoriesReorderMode"
                  mat-icon-button
                  (click)="editCategory(category)"
                  matTooltip="Edit Category"
                  [attr.aria-label]="'Edit category: ' + category.title"
                  color="primary"
                >
                  <mat-icon aria-hidden="true">edit</mat-icon>
                </button>
                <button
                  *ngIf="!categoriesReorderMode"
                  mat-icon-button
                  (click)="removeCategory(category)"
                  matTooltip="Delete Category"
                  [attr.aria-label]="'Delete category: ' + category.title"
                  color="warn"
                >
                  <mat-icon aria-hidden="true">folder_delete</mat-icon>
                </button>
                <button
                  *ngIf="categoriesReorderMode"
                  cdkDragHandle
                  mat-icon-button
                  matTooltip="Drag to reorder"
                  [attr.aria-label]="'Drag to reorder category: ' + category.title"
                  class="drag-handle"
                  type="button"
                >
                  <mat-icon aria-hidden="true">drag_handle</mat-icon>
                </button>
              </div>
            </div>

            <div
              *ngIf="!categoriesReorderMode"
              class="category-links"
              cdkDropList
              [cdkDropListData]="category.links"
              (cdkDropListDropped)="onCategoryLinksDropped($event, category)"
            >
              <output *ngIf="category.links.length === 0" class="empty-category" aria-live="polite">
                <p>No links in this category</p>
              </output>
              <div *ngFor="let link of category.links" class="link-item" cdkDrag>
                <div class="link-content">
                  <mat-icon *ngIf="link.icon" class="link-icon">{{ link.icon }}</mat-icon>
                  <div class="link-details">
                    <h4>{{ link.title }}</h4>
                    <p class="url">{{ link.url }}</p>
                    <p class="description" *ngIf="link.description">{{ link.description }}</p>
                  </div>
                </div>
                <div class="link-actions">
                  <button
                    mat-icon-button
                    matTooltip="Edit"
                    (click)="editLinkInCategory(link)"
                    [attr.aria-label]="'Edit link: ' + link.title"
                    color="primary"
                    class="edit-btn"
                  >
                    <mat-icon aria-hidden="true">edit</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    matTooltip="Remove"
                    (click)="removeLinkFromCategory(link.link_id, link.title)"
                    [attr.aria-label]="'Remove link: ' + link.title"
                    color="warn"
                    class="remove-btn"
                  >
                    <mat-icon aria-hidden="true">link_off</mat-icon>
                  </button>
                  <button
                    cdkDragHandle
                    mat-icon-button
                    matTooltip="Drag to reorder"
                    [attr.aria-label]="'Drag to reorder link: ' + link.title"
                    class="drag-handle"
                    type="button"
                  >
                    <mat-icon aria-hidden="true">drag_handle</mat-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </main>
</div>
