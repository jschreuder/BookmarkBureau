{
    # Disable automatic HTTPS (typically used behind reverse proxy on NAS)
    auto_https off
    # Disable admin API
    admin off
}

:8080 {
    # Document root is the web directory
    root * /var/www/web

    # Enable compression
    encode gzip

    # Security headers
    header {
        # Prevent clickjacking attacks
        X-Frame-Options "DENY"
        # Prevent MIME type sniffing
        X-Content-Type-Options "nosniff"
        # Control referrer information
        Referrer-Policy "strict-origin-when-cross-origin"
        # Content Security Policy - allows Angular inline styles and event handlers
        # Note: 'unsafe-inline' for script-src is needed for Angular, but limits CSP protection
        # Consider using nonces or hashes in production for better security
        Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' data: https://fonts.gstatic.com; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'"
        # Remove server identification
        -Server
    }

    # API endpoint - route to PHP-FPM (must come before try_files)
    @api {
        path /api.php /api.php/*
    }
    handle @api {
        reverse_proxy unix//var/www/var/run/php-fpm.sock {
            transport fastcgi {
                root /var/www/web
                split .php
            }
        }
    }

    # Angular SPA - serve static files, fallback to index.html for client-side routing
    handle {
        try_files {path} /index.html
        file_server
    }
}
